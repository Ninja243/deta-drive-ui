/**
 * @license
 * author: Deta
 * deta@0.0.10
 * Released under the MIT license.
 */
var deta = function (e) {
    "use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var t, r = function () { return (r = Object.assign || function (e) { for (var t, r = 1, n = arguments.length; r < n; r++)for (var o in t = arguments[r]) Object.prototype.hasOwnProperty.call(t, o) && (e[o] = t[o]); return e }).apply(this, arguments) }; function n(e, t, r, n) { return new (r || (r = Promise))((function (o, i) { function s(e) { try { u(n.next(e)) } catch (e) { i(e) } } function a(e) { try { u(n.throw(e)) } catch (e) { i(e) } } function u(e) { var t; e.done ? o(e.value) : (t = e.value, t instanceof r ? t : new r((function (e) { e(t) }))).then(s, a) } u((n = n.apply(e, t || [])).next()) })) } function o(e, t) { var r, n, o, i, s = { label: 0, sent: function () { if (1 & o[0]) throw o[1]; return o[1] }, trys: [], ops: [] }; return i = { next: a(0), throw: a(1), return: a(2) }, "function" == typeof Symbol && (i[Symbol.iterator] = function () { return this }), i; function a(i) { return function (a) { return function (i) { if (r) throw new TypeError("Generator is already executing."); for (; s;)try { if (r = 1, n && (o = 2 & i[0] ? n.return : i[0] ? n.throw || ((o = n.return) && o.call(n), 0) : n.next) && !(o = o.call(n, i[1])).done) return o; switch (n = 0, o && (i = [2 & i[0], o.value]), i[0]) { case 0: case 1: o = i; break; case 4: return s.label++, { value: i[1], done: !1 }; case 5: s.label++, n = i[1], i = [0]; continue; case 7: i = s.ops.pop(), s.trys.pop(); continue; default: if (!(o = s.trys, (o = o.length > 0 && o[o.length - 1]) || 6 !== i[0] && 2 !== i[0])) { s = 0; continue } if (3 === i[0] && (!o || i[1] > o[0] && i[1] < o[3])) { s.label = i[1]; break } if (6 === i[0] && s.label < o[1]) { s.label = o[1], o = i; break } if (o && s.label < o[2]) { s.label = o[2], s.ops.push(i); break } o[2] && s.ops.pop(), s.trys.pop(); continue }i = t.call(e, s) } catch (e) { i = [6, e], n = 0 } finally { r = o = 0 } if (5 & i[0]) throw i[1]; return { value: i[0] ? i[1] : void 0, done: !0 } }([i, a]) } } } function i(e) { return this instanceof i ? (this.v = e, this) : new i(e) } function s(e, t, r) { if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined."); var n, o = r.apply(e, t || []), s = []; return n = {}, a("next"), a("throw"), a("return"), n[Symbol.asyncIterator] = function () { return this }, n; function a(e) { o[e] && (n[e] = function (t) { return new Promise((function (r, n) { s.push([e, t, r, n]) > 1 || u(e, t) })) }) } function u(e, t) { try { (r = o[e](t)).value instanceof i ? Promise.resolve(r.value.v).then(c, l) : p(s[0][2], r) } catch (e) { p(s[0][3], e) } var r } function c(e) { u("next", e) } function l(e) { u("throw", e) } function p(e, t) { e(t), s.shift(), s.length && u(s[0][0], s[0][1]) } } !function (e) { e.Set = "set", e.Trim = "trim", e.Increment = "increment", e.Append = "append", e.Prepend = "prepend" }(t || (t = {})); var a, u = function (e, t) { this.operation = e, this.value = t }, c = function () { function e() { } return e.prototype.trim = function () { return new u(t.Trim) }, e.prototype.increment = function (e) { return void 0 === e && (e = 1), new u(t.Increment, e) }, e.prototype.append = function (e) { return new u(t.Append, Array.isArray(e) ? e : [e]) }, e.prototype.prepend = function (e) { return new u(t.Prepend, Array.isArray(e) ? e : [e]) }, e }(), l = { BASE_HOST_URL: "https://" + ((null === "" ? void 0 : "".trim()) || "database.deta.sh/v1") + "/:project_id/:base_name", DRIVE_HOST_URL: "https://" + ((null === "" ? void 0 : "".trim()) || "drive.deta.sh/v1") + "/:project_id/:drive_name" }; function p() { return "undefined" != typeof process && null != process.versions && null != process.versions.node } p() && (globalThis.fetch = require("node-fetch")), function (e) { e.Put = "PUT", e.Get = "GET", e.Post = "POST", e.Patch = "PATCH", e.Delete = "DELETE" }(a || (a = {})); var f = function () { function e(e, t) { var r = e.split("_")[0]; this.requestConfig = { baseURL: t.replace(":project_id", r), headers: { "X-API-Key": e } } } return e.prototype.put = function (t, n) { return e.fetch(t, r(r({}, this.requestConfig), { body: n, method: a.Put })) }, e.prototype.delete = function (t, i) { return n(this, void 0, void 0, (function () { return o(this, (function (n) { return [2, e.fetch(t, r(r({}, this.requestConfig), { body: i, method: a.Delete }))] })) })) }, e.prototype.get = function (t) { return n(this, void 0, void 0, (function () { return o(this, (function (n) { return [2, e.fetch(t, r(r({}, this.requestConfig), { method: a.Get }))] })) })) }, e.prototype.post = function (t, n) { return e.fetch(t, r(r({}, this.requestConfig), { body: n.payload, method: a.Post, headers: r(r({}, this.requestConfig.headers), n.headers) })) }, e.prototype.patch = function (t, n) { return e.fetch(t, r(r({}, this.requestConfig), { body: n, method: a.Patch })) }, e.fetch = function (e, t) { var i, s; return n(this, void 0, void 0, (function () { var n, a, u, c, l, p, f, h, d, y; return o(this, (function (o) { switch (o.label) { case 0: return o.trys.push([0, 9, , 10]), n = t.body instanceof Uint8Array ? t.body : JSON.stringify(t.body), a = (null === (i = null == t ? void 0 : t.headers) || void 0 === i ? void 0 : i["Content-Type"]) || "application/json", u = r(r({}, t.headers), { "Content-Type": a }), [4, fetch("" + t.baseURL + e, { body: n, headers: u, method: t.method })]; case 1: return (c = o.sent()).ok ? [3, 3] : [4, c.json()]; case 2: return l = o.sent(), p = (null === (s = null == l ? void 0 : l.errors) || void 0 === s ? void 0 : s[0]) || "Something went wrong", [2, { status: c.status, error: new Error(p) }]; case 3: return [4, c.blob()]; case 4: f = o.sent(), o.label = 5; case 5: return o.trys.push([5, 7, , 8]), y = (d = JSON).parse, [4, f.text()]; case 6: return h = y.apply(d, [o.sent()]), [2, { status: c.status, response: h }]; case 7: return o.sent(), [2, { status: c.status, response: f }]; case 8: return [3, 10]; case 9: return o.sent(), [2, { status: 500, error: new Error("Something went wrong") }]; case 10: return [2] } })) })) }, e }(), h = { PUT_ITEMS: "/items", QUERY_ITEMS: "/query", INSERT_ITEMS: "/items", GET_ITEMS: "/items/:key", PATCH_ITEMS: "/items/:key", DELETE_ITEMS: "/items/:key" }, d = { GET_FILE: "/files/download?name=:name", DELETE_FILES: "/files", LIST_FILES: "/files?prefix=:prefix&limit=:limit&last=:last", INIT_CHUNK_UPLOAD: "/uploads?name=:name", UPLOAD_FILE_CHUNK: "/uploads/:uid/parts?name=:name&part=:part", COMPLETE_FILE_UPLOAD: "/uploads/:uid?name=:name" }; function y(e) { return "[object Object]" === Object.prototype.toString.call(e) } var v = function () { function e(e, t) { var r = l.BASE_HOST_URL.replace(":base_name", t); this.requests = new f(e, r), this.util = new c } return e.prototype.put = function (e, t) { var i, s; return n(this, void 0, void 0, (function () { var n, a, u, c; return o(this, (function (o) { switch (o.label) { case 0: return n = [r(r({}, y(e) ? e : { value: e }), t && { key: t })], [4, this.requests.put(h.PUT_ITEMS, { items: n })]; case 1: if (a = o.sent(), u = a.response, c = a.error) throw c; return [2, (null === (s = null === (i = null == u ? void 0 : u.processed) || void 0 === i ? void 0 : i.items) || void 0 === s ? void 0 : s[0]) || null] } })) })) }, e.prototype.get = function (e) { return n(this, void 0, void 0, (function () { var t, r, n, i, s, a; return o(this, (function (o) { switch (o.label) { case 0: if (!(t = e.trim()).length) throw new Error("Key is empty"); return r = encodeURIComponent(t), [4, this.requests.get(h.GET_ITEMS.replace(":key", r))]; case 1: if (n = o.sent(), i = n.status, s = n.response, (a = n.error) && 404 !== i) throw a; return 200 === i ? [2, s] : [2, null] } })) })) }, e.prototype.delete = function (e) { return n(this, void 0, void 0, (function () { var t, r, n; return o(this, (function (o) { switch (o.label) { case 0: if (!(t = e.trim()).length) throw new Error("Key is empty"); return r = encodeURIComponent(t), [4, this.requests.delete(h.DELETE_ITEMS.replace(":key", r))]; case 1: if (n = o.sent().error) throw n; return [2, null] } })) })) }, e.prototype.insert = function (e, t) { return n(this, void 0, void 0, (function () { var n, i, s, a, u; return o(this, (function (o) { switch (o.label) { case 0: return n = r(r({}, y(e) ? e : { value: e }), t && { key: t }), [4, this.requests.post(h.INSERT_ITEMS, { payload: { item: n } })]; case 1: if (i = o.sent(), s = i.status, a = i.response, (u = i.error) && 409 === s) throw new Error("Item with key " + t + " already exists"); if (u) throw u; return [2, a] } })) })) }, e.prototype.putMany = function (e) { return n(this, void 0, void 0, (function () { var t, r, n, i; return o(this, (function (o) { switch (o.label) { case 0: if (!(e instanceof Array)) throw new Error("Items must be an array"); if (!e.length) throw new Error("Items can't be empty"); if (e.length > 25) throw new Error("We can't put more than 25 items at a time"); return t = e.map((function (e) { return y(e) ? e : { value: e } })), [4, this.requests.put(h.PUT_ITEMS, { items: t })]; case 1: if (r = o.sent(), n = r.response, i = r.error) throw i; return [2, n] } })) })) }, e.prototype.update = function (e, r) { return n(this, void 0, void 0, (function () { var n, i, s, a; return o(this, (function (o) { switch (o.label) { case 0: if (!(n = r.trim()).length) throw new Error("Key is empty"); return i = { set: {}, increment: {}, append: {}, prepend: {}, delete: [] }, Object.entries(e).forEach((function (e) { var r = e[0], n = e[1], o = n instanceof u ? n : new u(t.Set, n), s = o.operation, a = o.value; switch (s) { case t.Trim: i.delete.push(r); break; default: i[s][r] = a } })), s = encodeURIComponent(n), [4, this.requests.patch(h.PATCH_ITEMS.replace(":key", s), i)]; case 1: if (a = o.sent().error) throw a; return [2, null] } })) })) }, e.prototype.fetch = function (e, t, r) { return void 0 === e && (e = []), void 0 === t && (t = 10), s(this, arguments, (function () { var n, s, a, u, c, l, p, f, d, y; return o(this, (function (o) { switch (o.label) { case 0: n = "", s = Array.isArray(e) ? e : [e], a = 0, o.label = 1; case 1: return a < t ? (u = { query: s, limit: r, last: n }, [4, i(this.requests.post(h.QUERY_ITEMS, { payload: u }))]) : [3, 6]; case 2: if (c = o.sent(), l = c.response, p = c.error) throw p; return f = l.paging, d = l.items, y = f.last, [4, i(d)]; case 3: return [4, o.sent()]; case 4: if (o.sent(), !(n = y)) return [3, 6]; o.label = 5; case 5: return a += 1, [3, 1]; case 6: return [2] } })) })) }, e }(); var m = function () { function e(e, t) { var r = l.DRIVE_HOST_URL.replace(":drive_name", t); this.requests = new f(e, r) } return e.prototype.get = function (e) { return n(this, void 0, void 0, (function () { var t, r, n, i, s, a; return o(this, (function (o) { switch (o.label) { case 0: if (!(t = e.trim()).length) throw new Error("Name is empty"); return r = encodeURIComponent(t), [4, this.requests.get(d.GET_FILE.replace(":name", r))]; case 1: if (n = o.sent(), i = n.status, s = n.response, a = n.error, 404 === i && a) return [2, null]; if (a) throw a; return [2, s] } })) })) }, e.prototype.delete = function (e) { var t; return n(this, void 0, void 0, (function () { var r, n, i, s; return o(this, (function (o) { switch (o.label) { case 0: if (!e.trim().length) throw new Error("Name is empty"); return r = { names: [e] }, [4, this.requests.delete(d.DELETE_FILES, r)]; case 1: if (n = o.sent(), i = n.response, s = n.error) throw s; return [2, (null === (t = null == i ? void 0 : i.deleted) || void 0 === t ? void 0 : t[0]) || e] } })) })) }, e.prototype.deleteMany = function (e) { return n(this, void 0, void 0, (function () { var t, r, n, i, s; return o(this, (function (o) { switch (o.label) { case 0: if (!e.length) throw new Error("Names can't be empty"); if (e.length > 1e3) throw new Error("We can't delete more than 1000 items at a time"); return t = { names: e }, [4, this.requests.delete(d.DELETE_FILES, t)]; case 1: if (r = o.sent(), n = r.status, i = r.response, s = r.error, 400 === n && s) throw new Error("Names can't be empty"); if (s) throw s; return [2, i] } })) })) }, e.prototype.list = function (e) { return n(this, void 0, void 0, (function () { var t, r, n, i, s, a, u, c, l, p; return o(this, (function (o) { switch (o.label) { case 0: return r = (t = e || {}).prefix, n = void 0 === r ? "" : r, i = t.limit, s = void 0 === i ? 1e3 : i, a = t.last, u = void 0 === a ? "" : a, [4, this.requests.get(d.LIST_FILES.replace(":prefix", n).replace(":limit", s.toString()).replace(":last", u))]; case 1: if (c = o.sent(), l = c.response, p = c.error) throw p; return [2, l] } })) })) }, e.prototype.put = function (e, t) { return n(this, void 0, void 0, (function () { var r, n, i, s, a, u, c; return o(this, (function (o) { switch (o.label) { case 0: if (!(r = e.trim()).length) throw new Error("Name is empty"); if (n = encodeURIComponent(r), t.path && t.data) throw new Error("Please only provide data or a path. Not both"); if (!t.path && !t.data) throw new Error("Please provide data or a path. Both are empty"); if (t.path && !p()) throw new Error("Can't use path in browser environment"); return i = new Uint8Array, t.path ? [4, require("fs").promises.readFile(t.path)] : [3, 2]; case 1: s = o.sent(), i = new Uint8Array(s), o.label = 2; case 2: if (t.data) if (p() && t.data instanceof Buffer) i = function (e) { for (var t = new Uint8Array(e.length), r = 0; r < e.length; r += 1)t[r] = e[r]; return t }(t.data); else if ("string" == typeof (l = t.data) || l instanceof String) i = function (e) { for (var t = new Uint8Array(e.length), r = 0; r < e.length; r += 1)t[r] = e.charCodeAt(r); return t }(t.data); else { if (!(t.data instanceof Uint8Array)) throw new Error("Unsupported data format, expected data to be one of: string | Uint8Array | Buffer"); i = t.data } return [4, this.upload(n, i, t.contentType || "binary/octet-stream")]; case 3: if (a = o.sent(), u = a.response, c = a.error) throw c; return [2, u] }var l })) })) }, e.prototype.upload = function (e, t, r) { return n(this, void 0, void 0, (function () { var n, i, s, a, u, c, l, p, f, h, y, v, m; return o(this, (function (o) { switch (o.label) { case 0: return n = t.byteLength, i = 10485760, [4, this.requests.post(d.INIT_CHUNK_UPLOAD.replace(":name", e), { headers: { "Content-Type": r } })]; case 1: if (s = o.sent(), a = s.response, u = s.error) return [2, { error: u }]; c = a.upload_id, l = 1, p = 0, o.label = 2; case 2: return p < n ? (f = p, h = Math.min(p + i, n), y = t.slice(f, h), [4, this.requests.post(d.UPLOAD_FILE_CHUNK.replace(":uid", c).replace(":name", e).replace(":part", l.toString()), { payload: y, headers: { "Content-Type": r } })]) : [3, 5]; case 3: if (v = o.sent().error) return [2, { error: v }]; l += 1, o.label = 4; case 4: return p += i, [3, 2]; case 5: return [4, this.requests.patch(d.COMPLETE_FILE_UPLOAD.replace(":uid", c).replace(":name", e))]; case 6: return (m = o.sent().error) ? [2, { error: m }] : [2, { response: e }] } })) })) }, e }(), w = function () { function e(e) { this.projectKey = e } return e.prototype.Base = function (e) { var t = e.trim(); if (!t) throw new Error("Base name is not defined"); return new v(this.projectKey, t) }, e.prototype.Drive = function (e) { var t = e.trim(); if (!t) throw new Error("Drive name is not defined"); return new m(this.projectKey, t) }, e }(); function E(e) { var t = (null == e ? void 0 : e.trim()) || (null === "" ? void 0 : "".trim()); if (!t) throw new Error("Project key is not defined"); return new w(t) } return e.Base = function (e) { return E().Base(e) }, e.Deta = E, e.Drive = function (e) { return E().Drive(e) }, Object.defineProperty(e, "__esModule", { value: !0 }), e
}({});
